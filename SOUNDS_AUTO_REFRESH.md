# é¸Ÿå«å£°è‡ªåŠ¨åŒ–ä¸‹è½½ - ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

é¸Ÿå«å£°ä¸‹è½½åŠŸèƒ½å·²å®Œå…¨é›†æˆåˆ°weekly refreshè‡ªåŠ¨åŒ–æµç¨‹ä¸­ã€‚æ¯æ¬¡è¿è¡Œ `weekly_refresh_and_push.sh` æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š

1. æ£€æŸ¥å“ªäº›é¸Ÿç±»ç¼ºå°‘å«å£°
2. ä»Macaulay Libraryä¸‹è½½éŸ³é¢‘ï¼ˆæŒ‰è´¨é‡æ’åºï¼‰
3. ä¸Šä¼ åˆ°Cloudinaryæ‰˜ç®¡
4. æ›´æ–°JSONæ–‡ä»¶ï¼Œæ·»åŠ soundså­—æ®µ
5. æä¾›è¯¦ç»†çš„æˆåŠŸ/å¤±è´¥æ—¥å¿—

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ä¸€ï¼šæ­£å¸¸è¿è¡ŒWeekly Refreshï¼ˆæ¨èï¼‰

```bash
# è¿è¡Œweekly refreshï¼Œä¼šè‡ªåŠ¨å¤„ç†å›¾ç‰‡å’Œå£°éŸ³
bash tools/weekly_refresh_and_push.sh

# è‡ªå®šä¹‰åˆ·æ–°å¤©æ•°
REFRESH_DAYS=14 bash tools/weekly_refresh_and_push.sh

# åªå¤„ç†ç‰¹å®šåœ°ç‚¹
python3 tools/run_weekly_refresh.py --locations åœ†æ˜å›­ å¥¥æ£®åŒ—å›­
```

**æ³¨æ„**: weekly_refresh_and_push.sh ç°åœ¨ä¼šè‡ªåŠ¨åŠ è½½ eBird Tokenï¼ˆä¿®å¤äº†52ç§é¸Ÿéƒ½å¤±è´¥çš„é—®é¢˜ï¼‰

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨åŒæ­¥å·²æœ‰çš„ location_birds

å¦‚æœ location_birds ç›®å½•ä¸­çš„ JSON æ–‡ä»¶æ˜¯æ—§çš„ï¼ˆæ²¡æœ‰ sounds å­—æ®µï¼‰ï¼Œå¯ä»¥è¿è¡Œï¼š

```bash
# åŒæ­¥ä¸»ç›®å½•çš„ sounds å­—æ®µåˆ°æ‰€æœ‰ location_birds JSON
python3 tools/sync_sounds_to_location_birds.py
```

è¿™ä¼šï¼š
- éå†æ‰€æœ‰åœ°ç‚¹å’Œæ—¥æœŸçš„ JSON æ–‡ä»¶
- ä»ä¸»ç›®å½•å¤åˆ¶ sounds å­—æ®µ
- åªæ›´æ–°ç¼ºå¤±æˆ–è¿‡æœŸçš„ sounds æ•°æ®

**æµç¨‹è¯´æ˜**ï¼š
1. æŠ“å–å„åœ°ç‚¹çš„é¸Ÿç±»æ•°æ®
2. æ£€æŸ¥å¹¶ä¸‹è½½ç¼ºå¤±çš„å›¾ç‰‡
3. ä¸Šä¼ å›¾ç‰‡åˆ°Cloudinary
4. **â†’ è‡ªåŠ¨æ£€æŸ¥å¹¶ä¸‹è½½ç¼ºå¤±çš„å«å£°** â¬…ï¸ æ–°å¢
5. æ›´æ–°JSONå¹¶å¤åˆ¶åˆ°location_birdsç›®å½•
6. è‡ªåŠ¨æäº¤å¹¶æ¨é€åˆ°GitHub

### æ–¹å¼äºŒï¼šå•ç‹¬è¿è¡Œå£°éŸ³ä¸‹è½½

```bash
# ä¸ºç‰¹å®šé¸Ÿç±»ä¸‹è½½å£°éŸ³
source config/ebird_token.sh
python3 tools/auto_sounds_refresh.py bluetail marsh_tit

# æ‰¹é‡ä¸‹è½½ï¼ˆä½¿ç”¨JSONæ–‡ä»¶ï¼‰
python3 tools/batch_download_sounds.py birds_list.json sounds_download
python3 tools/batch_upload_sounds.py sounds_download/download_record.json
```

## ğŸ“Š è¾“å‡ºä¿¡æ¯

### è¿è¡Œæ—¶æ—¥å¿—

```
ğŸµ æ£€æŸ¥å’Œä¸‹è½½é¸Ÿå«å£°
================================================================================

ğŸ“Š å«å£°çŠ¶æ€:
  âœ… å·²æœ‰å«å£°: 45 ç§
  â³ éœ€è¦ä¸‹è½½: 12 ç§

éœ€è¦ä¸‹è½½çš„é¸Ÿç±»:
  - ç°å–œé¹Š (azure_winged_magpie)
  - å¤œé¹­ (black_crowned_night_heron)
  ...

[1/12] azure_winged_magpie
  ç°å–œé¹Š
  âœ“ eBird code: azwmag2
  âœ“ æ‰¾åˆ°éŸ³é¢‘ (Asset: 618307936, è¯„åˆ†: 4.67)
  âœ“ å·²ä¸‹è½½ (419.2KB)
  âœ“ å·²ä¸Šä¼ åˆ°Cloudinary
  âœ“ å·²æ›´æ–°JSON

[2/12] black_crowned_night_heron
  å¤œé¹­
  âœ“ eBird code: bcnher
  âœ“ æ‰¾åˆ°éŸ³é¢‘ (Asset: 170695891, è¯„åˆ†: 4.75)
  âœ“ å·²ä¸‹è½½ (770.2KB)
  âœ“ å·²ä¸Šä¼ åˆ°Cloudinary
  âœ“ å·²æ›´æ–°JSON

[3/12] grey_capped_woodpecker
  æ˜Ÿå¤´å•„æœ¨é¸Ÿ
  âš ï¸  æ— æ³•è·å–eBird codeï¼ˆå¯èƒ½eBirdæ•°æ®åº“ä¸­æ— æ­¤ç‰©ç§ï¼‰
```

### æ€»ç»“æŠ¥å‘Š

```
ğŸ“Š æ±‡æ€»ç»Ÿè®¡:
  Â· å¤„ç†åœ°ç‚¹: 3 ä¸ª
  Â· ç¼ºå¤±çš„æ–°é¸Ÿç±»: 15 ç§
  Â· å·²æˆåŠŸä¸‹è½½çš„é¸Ÿç±»: 14 ç§
  Â· å·²æˆåŠŸä¸Šä¼ çš„é¸Ÿç±»: 14 ç§
  Â· é¸Ÿå«å£°ä¸‹è½½æˆåŠŸ: 12 ç§
  Â· é¸Ÿå«å£°ä¸‹è½½å¤±è´¥: 3 ç§

ğŸ”Š é¸Ÿå«å£°ä¸‹è½½å¤±è´¥çš„é¸Ÿç±»ï¼ˆ3 ç§ï¼‰:
    - æ˜Ÿå¤´å•„æœ¨é¸Ÿ (grey_capped_woodpecker): eBirdæ•°æ®åº“ä¸­æ— æ­¤ç‰©ç§
    - æŸæŸé¸Ÿ (some_bird): Macaulay Libraryä¸­æ‰¾ä¸åˆ°éŸ³é¢‘
    - å¦ä¸€ç§é¸Ÿ (another_bird): éŸ³é¢‘ä¸‹è½½å¤±è´¥
```

## âŒ å¸¸è§å¤±è´¥åŸå› 

### 1. eBirdæ•°æ®åº“ä¸­æ— æ­¤ç‰©ç§
**åŸå› **: è¯¥ç‰©ç§æœªè¢«eBirdæ”¶å½•ï¼Œæˆ–å­¦åä¸åŒ¹é…  
**è§£å†³**: æ£€æŸ¥ `all_birds.csv` ä¸­çš„å­¦åæ˜¯å¦æ­£ç¡®ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ›´æ–°

### 2. Macaulay Libraryä¸­æ‰¾ä¸åˆ°éŸ³é¢‘
**åŸå› **: è¯¥ç‰©ç§æ²¡æœ‰éŸ³é¢‘è®°å½•ï¼Œæˆ–éŸ³é¢‘è´¨é‡ä¸ç¬¦åˆæ ‡å‡†  
**è§£å†³**: æš‚æ—¶æ— è§£ï¼Œéœ€è¦ç­‰å¾…æœ‰äººä¸Šä¼ è¯¥ç‰©ç§çš„éŸ³é¢‘

### 3. éŸ³é¢‘ä¸‹è½½å¤±è´¥
**åŸå› **: ç½‘ç»œé—®é¢˜æˆ–MacaulayæœåŠ¡å™¨é—®é¢˜  
**è§£å†³**: é‡æ–°è¿è¡Œè„šæœ¬ï¼Œæˆ–ä½¿ç”¨ä»£ç†

### 4. Cloudinaryä¸Šä¼ å¤±è´¥
**åŸå› **: ç½‘ç»œé—®é¢˜æˆ–Cloudinaryé…é¢å·²æ»¡  
**è§£å†³**: 
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç™»å½•Cloudinaryåå°æ£€æŸ¥å­˜å‚¨ç©ºé—´
- é‡æ–°è¿è¡Œè„šæœ¬

### 5. JSONæ›´æ–°å¤±è´¥
**åŸå› **: æ–‡ä»¶æƒé™é—®é¢˜æˆ–JSONæ ¼å¼é”™è¯¯  
**è§£å†³**: æ£€æŸ¥æ–‡ä»¶æƒé™ï¼Œæ‰‹åŠ¨ä¿®å¤JSONæ ¼å¼

## ğŸ”§ è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```bash
# è¿è¡Œæ—¶ä¼šæ˜¾ç¤ºè¯¦ç»†çš„æ­¥éª¤ä¿¡æ¯
python3 tools/run_weekly_refresh.py --locations åœ†æ˜å›­ 2>&1 | tee refresh.log
```

### æ‰‹åŠ¨æµ‹è¯•å•ä¸ªé¸Ÿç±»

```bash
source config/ebird_token.sh
python3 tools/auto_sounds_refresh.py <slug>
```

### æ£€æŸ¥JSONæ–‡ä»¶

```bash
# æŸ¥çœ‹æŸä¸ªé¸Ÿç±»çš„soundså­—æ®µ
python3 -c "
import json
with open('cloudinary_uploads/bluetail_cloudinary_urls.json', 'r') as f:
    data = json.load(f)
    sounds = data.get('sounds', [])
    if sounds:
        print(f'âœ“ æœ‰ {len(sounds)} ä¸ªéŸ³é¢‘')
        print(f'URL: {sounds[0][\"url\"]}')
    else:
        print('âœ— æ²¡æœ‰soundså­—æ®µ')
"
```

### éªŒè¯Cloudinaryä¸Šä¼ 

```bash
# æ£€æŸ¥éŸ³é¢‘URLæ˜¯å¦å¯è®¿é—®
curl -I "https://res.cloudinary.com/dzor6lhz8/video/upload/.../sounds/..."
```

## ğŸ“ ç›¸å…³æ–‡ä»¶

```
å°é¸Ÿè®°å¿†å¡/
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ weekly_refresh_and_push.sh      # ä¸»å…¥å£ï¼ˆBashï¼‰
â”‚   â”œâ”€â”€ run_weekly_refresh.py           # ä¸»é€»è¾‘ï¼ˆå·²é›†æˆå£°éŸ³ä¸‹è½½ï¼‰
â”‚   â”œâ”€â”€ auto_sounds_refresh.py          # å£°éŸ³æ£€æŸ¥å’Œä¸‹è½½æ¨¡å— â­
â”‚   â”œâ”€â”€ sync_sounds_to_location_birds.py # åŒæ­¥ sounds åˆ° location_birds â­
â”‚   â”œâ”€â”€ batch_download_sounds.py        # æ‰¹é‡ä¸‹è½½è„šæœ¬
â”‚   â””â”€â”€ batch_upload_sounds.py          # æ‰¹é‡ä¸Šä¼ è„šæœ¬
â”œâ”€â”€ cloudinary_uploads/
â”‚   â””â”€â”€ *_cloudinary_urls.json          # åŒ…å«soundså­—æ®µçš„JSONï¼ˆä¸»ç›®å½•ï¼‰
â”œâ”€â”€ feather-flash-quiz/location_birds/
â”‚   â””â”€â”€ <åœ°ç‚¹>/<æ—¥æœŸ>/*.json            # åŒ…å«soundså­—æ®µçš„JSONï¼ˆå·²åŒæ­¥ï¼‰
â””â”€â”€ config/
    â””â”€â”€ ebird_token.sh                  # eBird API Tokenï¼ˆå¿…éœ€ï¼‰
```

## âš™ï¸ é…ç½®è¦æ±‚

### å¿…éœ€çš„ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®eBird API Tokenï¼ˆå¿…éœ€ï¼‰
export EBIRD_TOKEN="your_token_here"

# æˆ–åœ¨è¿è¡Œå‰sourceé…ç½®æ–‡ä»¶
source config/ebird_token.sh
```

### Cloudinaryé…ç½®

å·²åœ¨è„šæœ¬ä¸­ç¡¬ç¼–ç ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼š
- Cloud Name: dzor6lhz8
- API Key: 972579995456539
- API Secret: pKXHi4_VR4fasuJ0AanitLGWfCM

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å®šæœŸè¿è¡Œ**: æ¯å‘¨è¿è¡Œä¸€æ¬¡ `weekly_refresh_and_push.sh`
2. **æ£€æŸ¥å¤±è´¥æ—¥å¿—**: æ³¨æ„å¤±è´¥çš„é¸Ÿç±»ï¼Œæ‰‹åŠ¨è®°å½•åŸå› 
3. **éªŒè¯éŸ³é¢‘è´¨é‡**: åœ¨Cloudinaryåå°å¬ä¸€ä¸‹æ–°ä¸Šä¼ çš„éŸ³é¢‘
4. **æ›´æ–°æ–‡æ¡£**: å¦‚å‘ç°æ–°çš„å¤±è´¥æ¨¡å¼ï¼Œæ›´æ–°æœ¬æ–‡æ¡£
5. **ä¿æŒTokenæœ‰æ•ˆ**: å®šæœŸæ£€æŸ¥eBird API Tokenæ˜¯å¦è¿‡æœŸ

## ğŸ“ˆ æ€§èƒ½è¯´æ˜

- **å¹³å‡ä¸‹è½½é€Ÿåº¦**: ~500KB/s
- **å•ä¸ªéŸ³é¢‘å¤„ç†æ—¶é—´**: 10-15ç§’
- **æ‰¹é‡å¤„ç†å»ºè®®**: æ¯æ‰¹ä¸è¶…è¿‡50ä¸ªé¸Ÿç±»
- **ç½‘ç»œè¦æ±‚**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥
- **å­˜å‚¨è¦æ±‚**: Cloudinaryå…è´¹è´¦æˆ·10GBï¼ˆéŸ³é¢‘è¾ƒå°ï¼Œå¤Ÿç”¨ï¼‰

## ğŸ†˜ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæ‰€æœ‰ä¸‹è½½éƒ½å¤±è´¥

**æ£€æŸ¥æ¸…å•**:
1. [ ] EBIRD_TOKEN æ˜¯å¦è®¾ç½®ï¼Ÿ â†’ `echo $EBIRD_TOKEN`
2. [ ] ç½‘ç»œæ˜¯å¦æ­£å¸¸ï¼Ÿ â†’ `ping api.ebird.org`
3. [ ] curl æ˜¯å¦å¯ç”¨ï¼Ÿ â†’ `which curl`
4. [ ] Pythonç¯å¢ƒæ˜¯å¦æ­£ç¡®ï¼Ÿ â†’ `python3 --version`

### é—®é¢˜ï¼šéƒ¨åˆ†é¸Ÿç±»ä¸‹è½½å¤±è´¥

**æ­¥éª¤**:
1. æŸ¥çœ‹å¤±è´¥åŸå› ï¼ˆåœ¨æ—¥å¿—ä¸­ï¼‰
2. å¦‚æœæ˜¯"eBirdæ— è®°å½•"ï¼Œæ£€æŸ¥å­¦åæ˜¯å¦æ­£ç¡®
3. å¦‚æœæ˜¯"Macaulayæ— éŸ³é¢‘"ï¼Œè®°å½•ä¸‹æ¥ï¼Œæš‚æ—¶è·³è¿‡
4. å¦‚æœæ˜¯"ä¸‹è½½å¤±è´¥"ï¼Œé‡è¯•å‡ æ¬¡

### é—®é¢˜ï¼šJSONæ›´æ–°å¤±è´¥

**æ­¥éª¤**:
1. æ£€æŸ¥æ–‡ä»¶æƒé™ï¼š`ls -l cloudinary_uploads/`
2. éªŒè¯JSONæ ¼å¼ï¼š`python3 -m json.tool cloudinary_uploads/xxx.json`
3. æ‰‹åŠ¨ä¿®å¤æˆ–é‡æ–°ç”ŸæˆJSON

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- `BIRD_SOUNDS_INTEGRATION.md` - å®Œæ•´çš„åŠŸèƒ½æ–‡æ¡£
- `tools/auto_sounds_refresh.py` - æºä»£ç æ³¨é‡Š
- GitHub Issues - æäº¤bugæˆ–åŠŸèƒ½è¯·æ±‚

---

æœ€åæ›´æ–°: 2024-11-28

