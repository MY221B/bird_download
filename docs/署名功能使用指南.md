# ğŸ“ ç½²ååŠŸèƒ½ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®å·²å…¨é¢æ”¯æŒç…§ç‰‡ç½²åä¿¡æ¯ç®¡ç†ï¼Œç¡®ä¿æ‰€æœ‰ä¸‹è½½çš„ç…§ç‰‡éƒ½åŒ…å«å®Œæ•´çš„ç½²åå…ƒæ•°æ®ï¼Œç¬¦åˆå„å¹³å°çš„è®¸å¯è¦æ±‚ã€‚

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®ç»“æ„æ›´æ–°
- âœ… æ‰€æœ‰ cloudinary_uploads JSON æ–‡ä»¶å·²æ·»åŠ  `attribution` å­—æ®µï¼ˆ289å¼ ç…§ç‰‡ï¼‰
- âœ… ç½²åæ•°æ®ç»“æ„æ ‡å‡†åŒ–ï¼š
```json
{
  "attribution": {
    "photographer": "æ‘„å½±å¸ˆå§“å",
    "photographer_url": "ç…§ç‰‡æˆ–æ‘„å½±å¸ˆé¡µé¢URL",
    "license": "è®¸å¯è¯ç±»å‹",
    "license_url": "è®¸å¯è¯è¯¦æƒ…é“¾æ¥",
    "credit_format": "æ¨èçš„å¼•ç”¨æ ¼å¼",
    "source": "æ¥æºå¹³å°",
    "source_id": "å¹³å°ç…§ç‰‡ID",
    "note": "å¤‡æ³¨ä¿¡æ¯"
  }
}
```

### 2. Macaulay Library ç½²åè¡¥å……
- âœ… æˆåŠŸä¸º 75/78 å¼  Macaulay ç…§ç‰‡è¡¥å……äº†ç½²åä¿¡æ¯
- âœ… åŒ…å«æ‘„å½±å¸ˆå§“åå’Œæ ‡å‡†å¼•ç”¨æ ¼å¼
- âœ… è¦†ç›– 26 ä¸ªé¸Ÿç§

### 3. ä¸‹è½½è„šæœ¬æ›´æ–°
- âœ… `fetch_four_sources.sh` - åœ¨ä¸‹è½½æ—¶è‡ªåŠ¨ä¿å­˜å…ƒæ•°æ®
- âœ… `download_from_avibase.py` - ä¿å­˜ Flickr photo ID
- âœ… `upload_to_cloudinary.py` - åˆå¹¶å…ƒæ•°æ®åˆ°ä¸Šä¼ è®°å½•

---

## ğŸ“Š ç½²åçŠ¶æ€æ€»è§ˆ

| æ¥æº | çŠ¶æ€ | å·²æœ‰æ•°æ® | æœªæ¥ä¸‹è½½ |
|------|------|----------|----------|
| **Macaulay Library** | âœ… å®Œæˆ | 75/78 å·²è¡¥å…… | è‡ªåŠ¨ä¿å­˜ |
| **iNaturalist** | â¸ï¸ é¢„ç•™ | å­—æ®µå·²å»ºç«‹ | è‡ªåŠ¨ä¿å­˜ |
| **Wikimedia Commons** | â¸ï¸ é¢„ç•™ | å­—æ®µå·²å»ºç«‹ | è‡ªåŠ¨ä¿å­˜ |
| **Avibase (Flickr)** | â¸ï¸ é¢„ç•™ | å­—æ®µå·²å»ºç«‹ | å¾…æ”¹è¿› |

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1ï¼šæ–°ä¸‹è½½é¸Ÿç±»ç…§ç‰‡ï¼ˆæ¨èï¼‰

æœªæ¥ä¸‹è½½çš„ç…§ç‰‡ä¼šè‡ªåŠ¨åŒ…å«ç½²åä¿¡æ¯ï¼š

```bash
# 1. ä¸‹è½½æ–°é¸Ÿç§ï¼ˆä¼šè‡ªåŠ¨ä¿å­˜ç½²åï¼‰
./tools/fetch_four_sources.sh new_bird "Bird Name" "Scientific Name"

# 2. ä¸Šä¼ åˆ° Cloudinaryï¼ˆä¼šè‡ªåŠ¨åˆå¹¶ç½²åï¼‰
python3 tools/upload_to_cloudinary.py new_bird

# 3. æŸ¥çœ‹ç½²åä¿¡æ¯
cat cloudinary_uploads/new_bird_cloudinary_urls.json
```

**è‡ªåŠ¨ä¿å­˜çš„å†…å®¹**ï¼š
- âœ… Macaulay: Asset ID + æ‘„å½±å¸ˆ + å¼•ç”¨æ ¼å¼
- âœ… iNaturalist: Observation ID + ç”¨æˆ· + è®¸å¯è¯ + å¼•ç”¨æ ¼å¼
- âœ… Wikimedia: åŸå§‹æ–‡ä»¶å + ä½œè€… + è®¸å¯è¯ + å¼•ç”¨æ ¼å¼
- âš ï¸ Flickr: Photo IDï¼ˆç½²åéœ€æ‰‹åŠ¨è¡¥å……ï¼‰

### æ–¹æ³•2ï¼šè¡¥å……å·²æœ‰ç…§ç‰‡çš„ç½²å

å¯¹äºå·²ä¸‹è½½çš„ç…§ç‰‡ï¼š

```bash
# è¡¥å…… Macaulay ç…§ç‰‡ç½²åï¼ˆåŸºäº asset IDï¼‰
python3 tools/fetch_macaulay_attribution.py

# ä¸ºæ‰€æœ‰æ•°æ®æ·»åŠ ç½²åå­—æ®µç»“æ„ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
python3 tools/add_attribution_fields.py
```

### æ–¹æ³•3ï¼šåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç½²åä¿¡æ¯

```python
import json

# è¯»å–ç…§ç‰‡æ•°æ®
with open('cloudinary_uploads/azure_winged_magpie_cloudinary_urls.json', 'r') as f:
    data = json.load(f)

# éå†ç…§ç‰‡å¹¶æ˜¾ç¤ºç½²å
for photo in data['macaulay']:
    print(f"ç…§ç‰‡: {photo['original_file']}")
    print(f"URL: {photo['url']}")
    
    # è·å–ç½²åä¿¡æ¯
    attr = photo.get('attribution', {})
    if attr.get('photographer'):
        print(f"æ‘„å½±å¸ˆ: {attr['photographer']}")
        print(f"å¼•ç”¨: {attr['credit_format']}")
    else:
        print("ç½²åä¿¡æ¯: å¾…è¡¥å……")
    print("-" * 50)
```

---

## ğŸ“‹ å„å¹³å°å¼•ç”¨æ ¼å¼

### Macaulay Library
```
æ ¼å¼: {ç‰©ç§å} by {æ‘„å½±å¸ˆ}; Cornell Lab of Ornithology | Macaulay Library
ç¤ºä¾‹: Azure-winged Magpie by Andy Lee; Cornell Lab of Ornithology | Macaulay Library
è®¸å¯: Â© Cornell Lab of Ornithology (éå•†ä¸šç”¨é€”)
```

### iNaturalist
```
æ ¼å¼: Â© {ç”¨æˆ·å} (via iNaturalist), some rights reserved ({è®¸å¯è¯})
ç¤ºä¾‹: Â© andrewbazdyrev (via iNaturalist), some rights reserved (CC-BY)
å¸¸è§è®¸å¯è¯: CC0, CC-BY, CC-BY-NC, CC-BY-SA
```

### Wikimedia Commons
```
æ ¼å¼: {ä½œè€…}, {è®¸å¯è¯}, via Wikimedia Commons
ç¤ºä¾‹: Donald Hobern from Copenhagen, Denmark, CC BY 2.0, via Wikimedia Commons
å¸¸è§è®¸å¯è¯: CC0, CC-BY, CC-BY-SA, CC-BY 2.0, CC-BY-SA 4.0
```

### Flickr (via Avibase)
```
æ ¼å¼: Photo by {æ‘„å½±å¸ˆ} on Flickr ({è®¸å¯è¯})
çŠ¶æ€: å­—æ®µå·²é¢„ç•™ï¼Œéœ€æ‰‹åŠ¨è¡¥å……æˆ–ä½¿ç”¨ Flickr API
```

---

## ğŸ› ï¸ å·¥å…·è„šæœ¬è¯´æ˜

### `add_attribution_fields.py`
ä¸ºå·²æœ‰çš„ cloudinary_uploads JSON æ–‡ä»¶æ·»åŠ ç©ºçš„ç½²åå­—æ®µã€‚

**ä½¿ç”¨åœºæ™¯**ï¼šåˆæ¬¡è®¾ç½®æˆ–ä¸ºæ—§æ•°æ®æ·»åŠ å­—æ®µç»“æ„

```bash
python3 tools/add_attribution_fields.py
```

### `fetch_macaulay_attribution.py`
åŸºäºæ–‡ä»¶åä¸­çš„ asset ID ä» Macaulay Library ç½‘é¡µæŠ“å–ç½²åä¿¡æ¯ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼šä¸ºå·²ä¸‹è½½çš„ Macaulay ç…§ç‰‡è¡¥å……ç½²å

```bash
python3 tools/fetch_macaulay_attribution.py
```

**æ³¨æ„**ï¼š
- è‡ªåŠ¨å¤„ç†æ‰€æœ‰ cloudinary_uploads ä¸­çš„ Macaulay ç…§ç‰‡
- è·³è¿‡å·²æœ‰ç½²åçš„ç…§ç‰‡
- æ¯ä¸ªè¯·æ±‚é—´éš” 1 ç§’ï¼Œé¿å…è¿‡å¿«è¯·æ±‚

---

## ğŸ“ å…ƒæ•°æ®æ–‡ä»¶è¯´æ˜

### `download_metadata.json`

ä¸‹è½½è„šæœ¬ä¼šåœ¨æ¯ä¸ªé¸Ÿç§ç›®å½•ä¸‹åˆ›å»ºæ­¤æ–‡ä»¶ï¼Œä¿å­˜ä¸‹è½½æ—¶çš„å…ƒæ•°æ®ï¼š

**ä½ç½®**ï¼š`images/{bird_slug}/download_metadata.json`

**ç»“æ„**ï¼š
```json
{
  "macaulay": [
    {
      "filename": "bird_205853451.jpg",
      "asset_id": "205853451",
      "asset_url": "https://macaulaylibrary.org/asset/205853451"
    }
  ],
  "inaturalist": [
    {
      "filename": "bird_1.jpg",
      "observation_id": "71373412",
      "photo_id": "116191357",
      "observation_url": "https://www.inaturalist.org/observations/71373412",
      "photographer": "andrewbazdyrev",
      "license": "cc-by",
      "credit_format": "Â© andrewbazdyrev (via iNaturalist), some rights reserved (CC-BY)"
    }
  ],
  "wikimedia": [...],
  "avibase": [...]
}
```

### `cloudinary_uploads/{bird}_cloudinary_urls.json`

ä¸Šä¼ åçš„ç…§ç‰‡è®°å½•ï¼ŒåŒ…å« Cloudinary URL å’Œç½²åä¿¡æ¯ï¼š

**ä½œç”¨**ï¼šåœ¨å…¶ä»–é¡¹ç›®ä¸­å¼•ç”¨ç…§ç‰‡æ—¶çš„æ•°æ®æº

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### è®¸å¯è¯åˆè§„
1. **éå•†ä¸šç”¨é€”**ï¼šMacaulay Library ç…§ç‰‡ä»…é™éå•†ä¸šä½¿ç”¨
2. **ç½²åè¦æ±‚**ï¼šæ‰€æœ‰ç…§ç‰‡ä½¿ç”¨æ—¶å¿…é¡»åŒ…å«ç½²å
3. **è®¸å¯è¯ç±»å‹**ï¼šæ³¨æ„æŸ¥çœ‹ `license` å­—æ®µï¼Œéµå®ˆå…·ä½“è®¸å¯è¯æ¡æ¬¾

### Flickr ç…§ç‰‡
- å½“å‰ä»…ä¿å­˜äº† photo ID
- ç½²åä¿¡æ¯éœ€è¦ï¼š
  - ç”³è¯· Flickr API key
  - æˆ–æ”¹è¿›ç½‘é¡µæŠ“å–é€»è¾‘
  - æˆ–æ‰‹åŠ¨ä» Flickr é¡µé¢è·å–

### æ•°æ®ä¸€è‡´æ€§
- ä¸‹è½½å…ƒæ•°æ®ï¼ˆ`download_metadata.json`ï¼‰å’Œä¸Šä¼ è®°å½•ï¼ˆ`cloudinary_uploads/*.json`ï¼‰åº”ä¿æŒåŒæ­¥
- é‡æ–°ä¸Šä¼ æ—¶ä¼šè‡ªåŠ¨åˆå¹¶å…ƒæ•°æ®

---

## ğŸ”„ æ›´æ–°å·²æœ‰æ•°æ®çš„å®Œæ•´æµç¨‹

å¦‚æœæ‚¨æƒ³ä¸ºæ‰€æœ‰å·²æœ‰æ•°æ®æ·»åŠ å®Œæ•´ç½²åï¼š

```bash
# 1. ä¸ºæ‰€æœ‰æ•°æ®æ·»åŠ ç½²åå­—æ®µç»“æ„
python3 tools/add_attribution_fields.py

# 2. è¡¥å…… Macaulay ç…§ç‰‡ç½²å
python3 tools/fetch_macaulay_attribution.py

# 3. é‡æ–°ä¸‹è½½ iNaturalist å’Œ Wikimediaï¼ˆå¯é€‰ï¼‰
# ä½¿ç”¨æ–°çš„ä¸‹è½½è„šæœ¬é‡æ–°ä¸‹è½½ï¼Œä¼šè‡ªåŠ¨ä¿å­˜ç½²å

# 4. éªŒè¯ç½²åä¿¡æ¯
cat cloudinary_uploads/azure_winged_magpie_cloudinary_urls.json | jq '.macaulay[0].attribution'
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æµ‹è¯•æŠ¥å‘Š**ï¼š`docs/ç½²åä¿¡æ¯è·å–æµ‹è¯•æŠ¥å‘Š.md` - è¯¦ç»†çš„å¯è¡Œæ€§æµ‹è¯•
- **README**ï¼šé¡¹ç›®ä¸»æ–‡æ¡£ï¼ŒåŒ…å«ç½²ååŠŸèƒ½æ¦‚è¿°
- **å¿«é€ŸæŒ‡å—**ï¼š`docs/å¿«é€ŸæŒ‡å—.md` - å®Œæ•´ä½¿ç”¨è¯´æ˜

---

## â“ å¸¸è§é—®é¢˜

**Q: æˆ‘çš„ç…§ç‰‡ç½²åä¿¡æ¯æ˜¾ç¤ºä¸º nullï¼Œæ€ä¹ˆåŠï¼Ÿ**

A: æœ‰å‡ ç§æƒ…å†µï¼š
1. ç…§ç‰‡æ˜¯æ—§æ•°æ®ï¼šè¿è¡Œ `fetch_macaulay_attribution.py` è¡¥å……ï¼ˆä»… Macaulayï¼‰
2. æ¥æºæ˜¯ Flickrï¼šå½“å‰éœ€è¦æ‰‹åŠ¨è¡¥å……
3. æ¥æºæ˜¯ iNaturalist/Wikimediaï¼šå»ºè®®é‡æ–°ä¸‹è½½

**Q: å¦‚ä½•åœ¨ç½‘é¡µä¸­æ˜¾ç¤ºç½²åä¿¡æ¯ï¼Ÿ**

A: è¯»å– `cloudinary_uploads/*.json` ä¸­çš„ `attribution.credit_format` å­—æ®µï¼Œåœ¨ç…§ç‰‡ä¸‹æ–¹æ˜¾ç¤ºã€‚

**Q: å¯ä»¥æ‰¹é‡å¯¼å‡ºæ‰€æœ‰ç…§ç‰‡çš„ç½²åä¿¡æ¯å—ï¼Ÿ**

A: å¯ä»¥ï¼Œä½¿ç”¨ä»¥ä¸‹è„šæœ¬ï¼š
```python
import json
import glob

all_attributions = []
for file in glob.glob('cloudinary_uploads/*_cloudinary_urls.json'):
    with open(file) as f:
        data = json.load(f)
        for source in ['macaulay', 'inaturalist', 'wikimedia', 'avibase']:
            for photo in data.get(source, []):
                attr = photo.get('attribution', {})
                if attr.get('photographer'):
                    all_attributions.append({
                        'file': photo['original_file'],
                        'source': source,
                        'photographer': attr['photographer'],
                        'credit': attr['credit_format']
                    })

# ä¿å­˜ä¸º CSV
import csv
with open('all_attributions.csv', 'w') as f:
    writer = csv.DictWriter(f, fieldnames=['file', 'source', 'photographer', 'credit'])
    writer.writeheader()
    writer.writerows(all_attributions)
```

---

æœ€åæ›´æ–°ï¼š2025-10-29

